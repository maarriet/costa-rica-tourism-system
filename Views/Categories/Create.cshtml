@model CategoryViewModel
@{
    ViewData["Title"] = "Agregar Nueva Categoría";
}

@section Styles {
    <link href="~/css/styles.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
}

<div class="container">
    <div class="section-header">
        <h2><i class="fas fa-plus"></i> Agregar Nueva Categoría</h2>
        <div class="section-actions">
            <a asp-action="Index" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver a Lista
            </a>
        </div>
    </div>

    <div class="form-container">
        <form asp-action="Create" method="post">
            <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

            <!-- Basic Information -->
            <div class="form-section">
                <h3><i class="fas fa-info-circle"></i> Información Básica</h3>

                <div class="form-row">
                    <div class="form-group col-md-8">
                        <label asp-for="Name" class="form-label">Nombre de la Categoría *</label>
                        <input asp-for="Name" class="form-control" placeholder="Ej: Hoteles y Hospedajes"
                               onkeyup="updatePreviewName(this.value)">
                        <span asp-validation-for="Name" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-4">
                        <label asp-for="IsActive" class="form-label">Estado Inicial</label>
                        <div class="form-check form-switch">
                            <input asp-for="IsActive" class="form-check-input" type="checkbox" checked>
                            <label class="form-check-label" asp-for="IsActive">
                                Categoría Activa
                            </label>
                        </div>
                        <small class="form-text text-muted">Las categorías activas aparecen en los formularios</small>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="Description" class="form-label">Descripción</label>
                    <textarea asp-for="Description" class="form-control" rows="3"
                              placeholder="Describe el tipo de lugares que incluye esta categoría..."></textarea>
                    <span asp-validation-for="Description" class="text-danger"></span>
                    <small class="form-text text-muted">Ayuda a los usuarios a entender qué tipo de lugares pertenecen a esta categoría</small>
                </div>
            </div>

            <!-- Visual Settings -->
            <div class="form-section">
                <h3><i class="fas fa-palette"></i> Configuración Visual</h3>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label asp-for="Icon" class="form-label">Icono (Font Awesome)</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">
                                    <i class="@(Model?.Icon ?? "fas fa-tag")" id="icon-preview"></i>
                                </span>
                            </div>
                            <input asp-for="Icon" class="form-control" placeholder="fas fa-hotel"
                                   value="@(Model?.Icon ?? "fas fa-tag")"
                                   onkeyup="updateIconPreview(this.value)">
                        </div>
                        <span asp-validation-for="Icon" class="text-danger"></span>
                        <small class="form-text text-muted">
                            <strong>Ejemplos populares:</strong><br>
                            • Hoteles: <code>fas fa-bed</code> o <code>fas fa-hotel</code><br>
                            • Restaurantes: <code>fas fa-utensils</code> o <code>fas fa-pizza-slice</code><br>
                            • Aventura: <code>fas fa-mountain</code> o <code>fas fa-hiking</code><br>
                            • Playas: <code>fas fa-umbrella-beach</code> o <code>fas fa-water</code>
                        </small>
                    </div>
                    <div class="form-group col-md-6">
                        <label asp-for="Color" class="form-label">Color de la Categoría</label>
                        <div class="input-group">
                            <input asp-for="Color" class="form-control" type="color"
                                   value="@(Model?.Color ?? "#007bff")"
                                   onchange="updateColorPreview(this.value)">
                            <div class="input-group-append">
                                <span class="input-group-text" id="color-preview"
                                      style="background-color: @(Model?.Color ?? "#007bff"); color: white;">
                                    Vista previa
                                </span>
                            </div>
                        </div>
                        <span asp-validation-for="Color" class="text-danger"></span>
                        <small class="form-text text-muted">Este color se usará en badges y elementos visuales</small>
                    </div>
                </div>

                <!-- Color Presets -->
                <div class="color-presets">
                    <label class="form-label">Colores Sugeridos:</label>
                    <div class="preset-colors">
                        <button type="button" class="color-preset" style="background-color: #007bff"
                                onclick="setPresetColor('#007bff')" title="Azul (Hoteles)"></button>
                        <button type="button" class="color-preset" style="background-color: #28a745"
                                onclick="setPresetColor('#28a745')" title="Verde (Naturaleza)"></button>
                        <button type="button" class="color-preset" style="background-color: #fd7e14"
                                onclick="setPresetColor('#fd7e14')" title="Naranja (Restaurantes)"></button>
                        <button type="button" class="color-preset" style="background-color: #dc3545"
                                onclick="setPresetColor('#dc3545')" title="Rojo (Aventura)"></button>
                        <button type="button" class="color-preset" style="background-color: #6f42c1"
                                onclick="setPresetColor('#6f42c1')" title="Púrpura (Entretenimiento)"></button>
                        <button type="button" class="color-preset" style="background-color: #20c997"
                                onclick="setPresetColor('#20c997')" title="Turquesa (Playas)"></button>
                        <button type="button" class="color-preset" style="background-color: #ffc107"
                                onclick="setPresetColor('#ffc107')" title="Amarillo (Tours)"></button>
                        <button type="button" class="color-preset" style="background-color: #6c757d"
                                onclick="setPresetColor('#6c757d')" title="Gris (Servicios)"></button>
                    </div>
                </div>

                <!-- Preview Card -->
                <div class="preview-section">
                    <h4>Vista Previa de la Categoría:</h4>
                    <div class="category-preview-card">
                        <i class="@(Model?.Icon ?? "fas fa-tag")" id="preview-icon"
                           style="color: @(Model?.Color ?? "#007bff")"></i>
                        <span id="preview-name">@(Model?.Name ?? "Nombre de Categoría")</span>
                        <span class="preview-badge" id="preview-badge"
                              style="background-color: @(Model?.Color ?? "#007bff")">Categoría</span>
                    </div>
                </div>
            </div>

            <!-- Quick Setup Templates -->
            <div class="form-section">
                <h3><i class="fas fa-magic"></i> Plantillas Rápidas</h3>
                <p class="text-muted">Haga clic en una plantilla para configurar automáticamente la categoría:</p>

                <div class="template-grid">
                    <button type="button" class="template-card" onclick="applyTemplate('hotel')">
                        <i class="fas fa-bed"></i>
                        <span>Hoteles</span>
                    </button>
                    <button type="button" class="template-card" onclick="applyTemplate('restaurant')">
                        <i class="fas fa-utensils"></i>
                        <span>Restaurantes</span>
                    </button>
                    <button type="button" class="template-card" onclick="applyTemplate('adventure')">
                        <i class="fas fa-mountain"></i>
                        <span>Aventura</span>
                    </button>
                    <button type="button" class="template-card" onclick="applyTemplate('beach')">
                        <i class="fas fa-umbrella-beach"></i>
                        <span>Playas</span>
                    </button>
                    <button type="button" class="template-card" onclick="applyTemplate('culture')">
                        <i class="fas fa-landmark"></i>
                        <span>Cultura</span>
                    </button>
                    <button type="button" class="template-card" onclick="applyTemplate('transport')">
                        <i class="fas fa-car"></i>
                        <span>Transporte</span>
                    </button>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save"></i> Crear Categoría
                </button>
                <a asp-action="Index" class="btn btn-secondary btn-lg">
                    <i class="fas fa-times"></i> Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script src="~/js/tourism-system.js"></script>
    <script>
        // Template configurations
        const templates = {
            hotel: {
                name: 'Hoteles y Hospedajes',
                description: 'Hoteles, hostales, cabañas y todo tipo de alojamiento turístico',
                icon: 'fas fa-bed',
                color: '#007bff'
            },
            restaurant: {
                name: 'Restaurantes y Gastronomía',
                description: 'Restaurantes, sodas, cafeterías y experiencias gastronómicas',
                icon: 'fas fa-utensils',
                color: '#fd7e14'
            },
            adventure: {
                name: 'Aventura y Deportes',
                description: 'Actividades de aventura, deportes extremos y recreación activa',
                icon: 'fas fa-mountain',
                color: '#dc3545'
            },
            beach: {
                name: 'Playas y Actividades Acuáticas',
                description: 'Playas, deportes acuáticos y actividades relacionadas con el mar',
                icon: 'fas fa-umbrella-beach',
                color: '#20c997'
            },
            culture: {
                name: 'Cultura y Patrimonio',
                description: 'Museos, sitios históricos, centros culturales y patrimonio',
                icon: 'fas fa-landmark',
                color: '#6f42c1'
            },
            transport: {
                name: 'Transporte y Servicios',
                description: 'Servicios de transporte, tours y servicios complementarios',
                icon: 'fas fa-car',
                color: '#6c757d'
            }
        };

        function applyTemplate(templateKey) {
            const template = templates[templateKey];
            if (template) {
                document.querySelector('input[name="Name"]').value = template.name;
                document.querySelector('textarea[name="Description"]').value = template.description;
                document.querySelector('input[name="Icon"]').value = template.icon;
                document.querySelector('input[name="Color"]').value = template.color;

                updateIconPreview(template.icon);
                updateColorPreview(template.color);
                updatePreviewName(template.name);
            }
        }

        function updateIconPreview(iconClass) {
            const cleanIcon = iconClass || 'fas fa-tag';
            document.getElementById('icon-preview').className = cleanIcon;
            document.getElementById('preview-icon').className = cleanIcon;
        }

        function updateColorPreview(color) {
            document.getElementById('color-preview').style.backgroundColor = color;
            document.getElementById('preview-icon').style.color = color;
            document.getElementById('preview-badge').style.backgroundColor = color;
        }

        function updatePreviewName(name) {
            document.getElementById('preview-name').textContent = name || 'Nombre de Categoría';
        }

        function setPresetColor(color) {
            document.querySelector('input[name="Color"]').value = color;
            updateColorPreview(color);
        }

        // Initialize preview on page load
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.querySelector('input[name="Name"]');
            const iconInput = document.querySelector('input[name="Icon"]');
            const colorInput = document.querySelector('input[name="Color"]');

            if (nameInput.value) updatePreviewName(nameInput.value);
            if (iconInput.value) updateIconPreview(iconInput.value);
            if (colorInput.value) updateColorPreview(colorInput.value);
        });
    </script>
}